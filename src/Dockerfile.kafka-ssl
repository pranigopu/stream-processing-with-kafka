FROM confluentinc/cp-kafka:latest

USER root

# Install OpenSSL
RUN yum install -y openssl || apt-get update && apt-get install -y openssl

# Copy certificate generation script
COPY scripts/generate-certs.sh /tmp/generate-certs.sh

# Generate certificates during build
RUN mkdir -p /etc/kafka/secrets && \
    cd /etc/kafka/secrets && \
    bash /tmp/generate-certs.sh && \
    chown -R appuser:appuser /etc/kafka/secrets

USER appuser

# Default command
CMD ["/etc/confluent/docker/run"]